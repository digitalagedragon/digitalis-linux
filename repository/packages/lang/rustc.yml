version: "1.44.1"
bdepend:
  - lang/llvm
  - libs/libffi
  - util/curl
rdepend:
  - lang/llvm
  - libs/libffi
comp: tar.gz
src: rustc-%{version}-src.%{comp}
unpack_dir: rustc-%{version}-src
upstream: https://static.rust-lang.org/dist/
license: MIT
configure: |
  cat << EOF > config.toml
  [llvm]
  targets = "X86"
  link-shared = true

  [build]
  docs = false
  extended = true

  [install]
  prefix = "/usr"
  docdir = "share/doc/"

  [rust]
  channel = "stable"
  rpath = false
  codegen-tests = false

  [target.x86_64-unknown-linux-gnu]
  llvm-config = "/usr/bin/llvm-config"
  EOF
#make: export RUSTFLAGS="$RUSTFLAGS -C link-args=-lffi" && python3 ./x.py build --exclude src/tools/miri %{make_options}
make: ~
install: DESTDIR=/target_root RUSTFLAGS="$RUSTFLAGS -C link-args=-lffi" python3 ./x.py install --exclude src/tools/miri
queue_hooks:
  ldconfig: true