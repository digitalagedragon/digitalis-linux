# https://git.archlinux.org/svntogit/packages.git/tree/trunk/PKGBUILD?h=packages/mkinitcpio-busybox
version: "1.31.1"
bdepend:
  - util/diffutils
  - util/bzip2
  - lang/gcc
filename: busybox
comp: tar.bz2
upstream: https://busybox.net/downloads/
license: GPL-2.0-only
configure: ~
# r?date doesn't build against this libc, so just don't bother
pre_configure_script: |
  CARCH=$(uname -m)
  safeflags="-march=${CARCH/_/-} -mtune=generic -Os -pipe -fno-strict-aliasing"
  make defconfig
  sed -i 's|^\(CONFIG_EXTRA_CFLAGS\)=.*|\1="'"$safeflags"'"|' .config
  sed -i 's/CONFIG_DATE=y/CONFIG_DATE=n/' .config
  sed -i 's/CONFIG_RDATE=y/CONFIG_RDATE=n/' .config
install: |
  # install -D is *supposed* to do this for me...
  mkdir -p /target_root/usr/lib/initcpio
  install -Dm755 busybox /target_root/usr/lib/initcpio/
